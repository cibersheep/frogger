var Frogger=function(){var e=document.getElementById("canvas"),t=e.getContext("2d"),r=document.getElementById("background-canvas"),o=r.getContext("2d"),i=e.width,n=e.height;return{canvas:e,drawingSurface:t,drawingSurfaceWidth:i,drawingSurfaceHeight:n,backgroundDrawingSurface:o,direction:{UP:"up",DOWN:"down",LEFT:"left",RIGHT:"right"},observer:function(){var e={};return{subscribe:function(t,r){e.hasOwnProperty(t)||(e[t]=[]),e[t].push(r)},publish:function(t){var r=Array.prototype.slice.call(arguments,1),o=0,i=0;if(e.hasOwnProperty(t))for(i=e[t].length;i>o;o++)e[t][o].apply(this,r)}}}(),intersects:function(e,t){var r=!1;return(e.left>t.left&&e.left<t.right||e.right>t.left&&e.left<t.right)&&(r=!0),r}}}();window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),function(e){function t(){w>0?(w-=b,e.observer.publish("time-remaining-change",w/m)):i()}function r(){n(),e.observer.publish("game-over"),t1=window.setTimeout(function(){window.location="index.html"},5e3)}function o(){e.observer.publish("game-won"),t1=window.setTimeout(function(){window.location.reload(true);},5e3)}function i(){d--,n(),e.observer.publish("player-lost-life"),0===d?r():setTimeout(u,2e3)}function n(){S=!0,e.observer.publish("player-freeze")}function s(){S=!1,e.observer.publish("player-unfreeze")}function a(t){h+=t||0,e.observer.publish("score-change",h),h>f&&(f=h,e.observer.publish("high-score-change",f))}function c(){a(1e3),y++,n(),v>y?setTimeout(u,2e3):o()}function p(){a(20)}function u(){w=m,s(),e.observer.publish("reset")}function l(){var r=(new Date).getTime(),o=r-T;window.requestAnimationFrame(l),b>o||(e.drawingSurface.clearRect(0,0,e.drawingSurfaceWidth,e.drawingSurfaceHeight),S||(t(),e.observer.publish("check-collisions")),e.observer.publish("render-base-layer"),e.observer.publish("render-character"),T=r)}function g(){e.observer.publish("high-score-change",f),l()}var h=0,f=1e3,d=5,m=6e4,w=m,b=33.333,y=0,v=5,S=!1,T=(new Date).getTime();e.observer.subscribe("game-load",g),e.observer.subscribe("player-at-goal",c),e.observer.subscribe("player-moved",p),e.observer.subscribe("collision",i)}(Frogger),Frogger.ImageSprite=function(e,t){this.startLeft=e||0,this.startTop=t||0,this.animations={},this.reset()},Frogger.Animation=function(e){e=e||{},this.rate=e.rate||150,this.loop=e.loop||!1,this.spriteLeft=e.spriteLeft||0,this.sequence=e.sequence||[]},Frogger.Animation.prototype={frame:0,playing:!1,timer:null,play:function(){var e=this;this.playing||(this.reset(),this.playing=!0),this.timer=setInterval(function(){e.incrementFrame()},this.rate)},reset:function(){this.frame=0},incrementFrame:function(){this.playing&&(this.frame++,this.frame===this.sequence.length-1&&(this.loop?this.reset():this.stop()))},getSequenceValue:function(){return this.sequence[this.frame]},getSpriteLeft:function(){return this.spriteLeft},stop:function(){clearInterval(this.timer),this.playing=!1}},Frogger.ImageSprite.prototype={top:0,left:0,startLeft:0,startTop:0,sprite:function(){var e=document.createElement("img");return e.src="images/spritemap.png",e}(),width:80,height:80,spriteTop:0,spriteLeft:0,animations:null,currentAnimation:"",isHidden:!1,reset:function(){this.left=this.startLeft,this.top=this.startTop,this.resetAnimation(),this.isHidden=!1},registerAnimation:function(e){var t,r;for(t in e)r=e[t],this.animations[t]=new Frogger.Animation(r)},resetAnimation:function(){this.animations[this.currentAnimation]&&this.animations[this.currentAnimation].reset(),this.currentAnimation=""},playAnimation:function(e){this.currentAnimation=e,this.animations[this.currentAnimation]&&this.animations[this.currentAnimation].play()},renderAt:function(e,t){var r=this.animations[this.currentAnimation],o=r?r.getSequenceValue():0,i=r?r.getSpriteLeft():0,n=this.spriteLeft+i+this.width*o;this.isHidden||Frogger.drawingSurface.drawImage(this.sprite,n,this.spriteTop,this.width,this.height,e,t,this.width,this.height)},moveTo:function(e,t){this.left=e||0,void 0!==t&&(this.top=t||0)},getWidth:function(){return this.width},getPosition:function(){return{left:this.left,right:this.left+this.width}},hide:function(){this.isHidden=!0}},function(e){var t={width:80,height:80},r=16,o=11,i={left:0,right:o*t.width,top:2*t.height,bottom:(r-2)*t.height},n=function(){for(var e=[],o=0,i=r;i>o;o++)e.push(o*t.width);return e}(),s=function(){for(var e=[],r=0,i=o;i>r;r++)e.push(r*t.height);return e}();e.observer.subscribe("game-load",function(){e.observer.publish("game-board-initialize",{numRows:r,numColumns:o,rows:n,columns:s,grid:{width:t.width,height:t.height},characterBounds:i})})}(Frogger),function(e){function t(){e.drawingSurface.font=s,e.drawingSurface.textAlign="end",e.drawingSurface.fillStyle="#FFF",e.drawingSurface.fillText("1-UP",l.columns[3],l.grid.height/2),e.drawingSurface.fillStyle="#F00",e.drawingSurface.fillText(a,l.columns[3],l.grid.height),e.drawingSurface.fillStyle="#FFF",e.drawingSurface.fillText("HI-SCORE",l.columns[8],l.grid.height/2),e.drawingSurface.fillStyle="#F00",e.drawingSurface.fillText(c,l.columns[8],l.grid.height)}function r(){e.drawingSurface.font=s,e.drawingSurface.textAlign="center",e.drawingSurface.fillStyle="#FFF",e.drawingSurface.fillText("GAME OVER",e.drawingSurfaceWidth/2,l.rows[9])}function o(){e.drawingSurface.font=s,e.drawingSurface.textAlign="center",e.drawingSurface.fillStyle="#FF0",e.drawingSurface.fillText("YOU WIN!",e.drawingSurfaceWidth/2,l.rows[9])}function i(){e.drawingSurface.font=s,e.drawingSurface.textAlign="end",e.drawingSurface.fillStyle="#FF0",e.drawingSurface.fillText("TIME",e.drawingSurfaceWidth,e.drawingSurfaceHeight)}function n(){t(),i(),u&&r(),p&&o()}var s="67px Arcade Classic",a=0,c=0,p=!1,u=!1,l={};e.observer.subscribe("game-won",function(){p=!0}),e.observer.subscribe("game-over",function(){u=!0}),e.observer.subscribe("reset",function(){u=!1,p=!1}),e.observer.subscribe("score-change",function(e){a=e}),e.observer.subscribe("high-score-change",function(e){c=e}),e.observer.subscribe("game-board-initialize",function(t){l=t,e.observer.subscribe("render-base-layer",n)})}(Frogger),function(e){var t=document.createElement("img");t.addEventListener("load",function(){e.backgroundDrawingSurface.drawImage(t,0,0,e.drawingSurfaceWidth,e.drawingSurfaceHeight)},!1),t.src="images/gameboard.gif"}(Frogger),function(e){function t(t,r){e.ImageSprite.call(this,t,r)}function r(r){var o;s=r,o=(s.numRows-1)*s.grid.height,a=[new t(0,o),new t(1*t.prototype.width,o),new t(2*t.prototype.width,o),new t(3*t.prototype.width,o),new t(4*t.prototype.width,o)],e.observer.subscribe("render-base-layer",n)}function o(){for(var e,t=0,r=a.length;r>t;t++)e=a[t],e.renderAt(e.left,e.top)}function i(){var t=c*s.rows[10],r=s.grid.height/2,o=(1-c)*s.rows[10],i=e.drawingSurfaceHeight-r;e.drawingSurface.fillStyle="#0F0",e.drawingSurface.fillRect(o,i,t,r)}function n(){o(),i()}var s,a=[],c=100;t.prototype=new e.ImageSprite,t.prototype.constructor=t,t.prototype.spriteLeft=720,t.prototype.spriteTop=80,t.prototype.width=40,t.prototype.height=40,e.observer.subscribe("player-lost-life",function(){a.pop()}),e.observer.subscribe("time-remaining-change",function(e){c=e}),e.observer.subscribe("game-board-initialize",r)}(Frogger),Frogger.Image=function(e){function t(t){e.ImageSprite.call(this,t)}function r(t){e.ImageSprite.call(this,t)}function o(t){e.ImageSprite.call(this,t)}function i(t){e.ImageSprite.call(this,t)}function n(t){e.ImageSprite.call(this,t)}function s(t){e.ImageSprite.call(this,t)}function a(t){e.ImageSprite.call(this,t)}function c(t){e.ImageSprite.call(this,t)}function p(t){e.ImageSprite.call(this,t)}function u(e){p.call(this,e)}function l(e){p.call(this,e)}function g(t){e.ImageSprite.call(this,t)}function h(t){e.ImageSprite.call(this,t)}return t.prototype=new e.ImageSprite,t.prototype.constructor=t,t.prototype.spriteLeft=0,t.prototype.spriteTop=80,r.prototype=new e.ImageSprite,r.prototype.constructor=r,r.prototype.spriteLeft=80,r.prototype.spriteTop=80,o.prototype=new e.ImageSprite,o.prototype.constructor=o,o.prototype.spriteLeft=160,o.prototype.spriteTop=80,i.prototype=new e.ImageSprite,i.prototype.constructor=i,i.prototype.spriteLeft=240,i.prototype.spriteTop=80,n.prototype=new e.ImageSprite,n.prototype.constructor=n,n.prototype.spriteLeft=320,n.prototype.spriteTop=80,n.prototype.width=122,s.prototype=new e.ImageSprite,s.prototype.constructor=s,s.prototype.spriteLeft=0,s.prototype.spriteTop=160,s.prototype.width=190,a.prototype=new e.ImageSprite,a.prototype.constructor=a,a.prototype.spriteLeft=0,a.prototype.spriteTop=240,a.prototype.width=254,c.prototype=new e.ImageSprite,c.prototype.constructor=c,c.prototype.spriteLeft=240,c.prototype.spriteTop=160,c.prototype.width=392,p.prototype=new e.ImageSprite,p.prototype.constructor=p,p.prototype.isUnderwater=function(){var e=!1,t=this.animations[this.currentAnimation];return t.getSequenceValue()===Math.max.apply(Math,t.sequence)&&(e=!0),e},u.prototype=new p,u.prototype.constructor=u,u.prototype.spriteLeft=320,u.prototype.spriteTop=240,u.prototype.width=130,u.prototype.reset=function(){p.prototype.reset.call(this),this.registerAnimation({diveAndSurface:{sequence:[0,1,2,3,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0],loop:!0,rate:200}}),this.playAnimation("diveAndSurface")},l.prototype=new p,l.prototype.constructor=l,l.prototype.spriteLeft=0,l.prototype.spriteTop=320,l.prototype.width=200,l.prototype.reset=function(){p.prototype.reset.call(this),this.registerAnimation({diveAndSurface:{sequence:[0,1,2,3,3,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0],loop:!0,rate:300}}),this.playAnimation("diveAndSurface")},g.prototype=new e.ImageSprite,g.prototype.constructor=g,g.prototype.spriteLeft=640,g.prototype.spriteTop=80,g.prototype.moveTo=function(){},h.prototype=new e.ImageSprite,h.prototype.constructor=h,h.prototype.spriteLeft=800,h.prototype.spriteTop=320,h.prototype.moveTo=function(){},h.prototype.isMet=!1,{RaceCar:t,Bulldozer:r,RoadCar:i,TurboRaceCar:o,Truck:n,ShortLog:s,MediumLog:a,LongLog:c,TwoTurtles:u,ThreeTurtles:l,GoalFrog:g,Goal:h}}(Frogger),Frogger.Character=function(e){function t(t,r){e.ImageSprite.call(this,t,r),this.registerAnimation({"lose-life":{spriteLeft:640,sequence:[0,1,2],rate:350},"move-up":{spriteLeft:0,sequence:[1,0]},"move-right":{spriteLeft:160,sequence:[1,0]},"move-down":{spriteLeft:320,sequence:[1,0]},"move-left":{spriteLeft:480,sequence:[1,0]}})}function r(){return f.rows[w]}function o(){h.hide()}function i(t){b||(t===e.direction.LEFT?h.moveLeft():t===e.direction.RIGHT?h.moveRight():t===e.direction.UP?h.moveUp():t===e.direction.DOWN&&h.moveDown(),e.observer.publish("player-moved"))}function n(){h.renderAt(h.left,h.top)}function s(){h.playAnimation("lose-life")}function a(e){e>f.characterBounds.right?e=f.characterBounds.right:e<f.characterBounds.left&&(e=f.characterBounds.left),h.moveTo(e)}function c(){h.reset(),w=d}function p(){return h.getPosition()}function u(){b=!0}function l(){b=!1}function g(r){f=r,h=new t(f.columns[m],f.rows[d]),e.observer.subscribe("render-character",n)}var h,f={},d=14,m=6,w=d,b=!1;return t.prototype=new e.ImageSprite,t.prototype.constructor=t,t.prototype.spriteLeft=0,t.prototype.spriteTop=0,t.prototype.moveUp=function(){this.top-=f.grid.height,this.top<f.characterBounds.top&&(this.top=f.characterBounds.top),this.playAnimation("move-up"),w--},t.prototype.moveDown=function(){this.top+=f.grid.height,this.top>f.characterBounds.bottom?this.top=f.characterBounds.bottom:w++,this.playAnimation("move-down")},t.prototype.moveLeft=function(){this.left-=f.grid.width,this.left<f.characterBounds.left&&(this.left=f.characterBounds.left),this.playAnimation("move-left")},t.prototype.moveRight=function(){this.left+=f.grid.width,this.left>f.characterBounds.right&&(this.left=f.characterBounds.right),this.playAnimation("move-right")},e.observer.subscribe("player-lost-life",s),e.observer.subscribe("reset",c),e.observer.subscribe("player-at-goal",o),e.observer.subscribe("player-freeze",u),e.observer.subscribe("player-unfreeze",l),e.observer.subscribe("game-board-initialize",g),window.addEventListener("keydown",function(t){var r=37,o=38,n=39,s=40;t.keyCode===r?i(e.direction.LEFT):t.keyCode===n?i(e.direction.RIGHT):t.keyCode===o?i(e.direction.UP):t.keyCode===s&&i(e.direction.DOWN)},!1),e.canvas.addEventListener("touchstart",function(t){var r=t.targetTouches[0].clientX,o=t.targetTouches[0].clientY;o<screen.height/3?i(e.direction.UP):o>2*(screen.height/3)?i(e.direction.DOWN):r>screen.width/2?i(e.direction.RIGHT):r<screen.width/2&&i(e.direction.LEFT)},!1),{getTop:r,getPosition:p,setPosition:a}}(Frogger),Frogger.Row=function(){function e(e){e=e||{},this.direction=e.direction||Frogger.direction.LEFT,this.obstacles=e.obstacles||[],this.top=e.top||0,this.speed=e.speed||1}function t(t){e.call(this,t)}function r(t){e.call(this,t)}function o(e){r.call(this,e)}function i(t){t.speed=0,e.call(this,t)}return e.prototype={render:function(){for(var e,t,r=0,o=this.obstacles.length;o>r;r++)t=this.obstacles[r],e=t.getPosition().left+(this.direction===Frogger.direction.RIGHT?1:-1)*this.speed,e<-t.getWidth()?e=Frogger.drawingSurfaceWidth:e<Frogger.drawingSurfaceWidth||(e=-t.getWidth()),t.moveTo(e),t.renderAt(e,this.top)},getTop:function(){return this.top},isCollision:function(e){for(var t,r=0,o=this.obstacles.length,i=!1;o>r;r++)t=this.obstacles[r],Frogger.intersects(t.getPosition(),e)&&(i=!0);return i},reset:function(){for(var e=0,t=this.obstacles.length;t>e;e++)this.obstacles[e].reset()}},t.prototype=new e,t.prototype.constructor=t,r.prototype=new e,r.prototype.constructor=r,r.prototype.isCollision=function(t){return!e.prototype.isCollision.call(this,t)},r.prototype.render=function(){Frogger.Character.getTop()===this.getTop()&&Frogger.Character.setPosition(Frogger.Character.getPosition().left+(this.direction===Frogger.direction.RIGHT?1:-1)*this.speed),e.prototype.render.call(this)},o.prototype=new r,o.prototype.constructor=o,o.prototype.isCollision=function(e){var t=r.prototype.isCollision.call(this,e);return this.obstacles[0].isUnderwater()||t},i.prototype=new e,i.prototype.constructor=i,i.prototype.isCollision=function(e){for(var t,r=0,o=this.obstacles.length,i=!0;o>r;r++)t=this.obstacles[r],!t.isMet&&Frogger.intersects(t.getPosition(),e)&&(this.obstacles[r].isMet=!0,Frogger.observer.publish("player-at-goal"),i=!1,this.obstacles.push(new Frogger.Image.GoalFrog(t.getPosition().left)));return i},{Road:t,Log:r,Turtle:o,Goal:i}}(Frogger),function(e){function t(t){s=t,n=[new e.Row.Goal({top:s.rows[2],obstacles:[new e.Image.Goal(33,111),new e.Image.Goal(237,315),new e.Image.Goal(441,519),new e.Image.Goal(645,723),new e.Image.Goal(849,927)]}),new e.Row.Log({top:s.rows[3],direction:e.direction.RIGHT,speed:5,obstacles:[new e.Image.MediumLog(s.columns[1]),new e.Image.MediumLog(s.columns[6]),new e.Image.MediumLog(s.columns[10])]}),new e.Row.Turtle({top:s.rows[4],speed:6,obstacles:[new e.Image.TwoTurtles(s.columns[0]),new e.Image.TwoTurtles(s.columns[3]),new e.Image.TwoTurtles(s.columns[6]),new e.Image.TwoTurtles(s.columns[9])]}),new e.Row.Log({top:s.rows[5],direction:e.direction.RIGHT,speed:7,obstacles:[new e.Image.LongLog(s.columns[1]),new e.Image.LongLog(s.columns[10])]}),new e.Row.Log({top:s.rows[6],direction:e.direction.RIGHT,speed:3,obstacles:[new e.Image.ShortLog(s.columns[1]),new e.Image.ShortLog(s.columns[6]),new e.Image.ShortLog(s.columns[10])]}),new e.Row.Turtle({top:s.rows[7],speed:5,obstacles:[new e.Image.ThreeTurtles(s.columns[0]),new e.Image.ThreeTurtles(s.columns[3]),new e.Image.ThreeTurtles(s.columns[7]),new e.Image.ThreeTurtles(s.columns[10])]}),new e.Row.Road({top:s.rows[9],speed:3,obstacles:[new e.Image.Truck(s.columns[1]),new e.Image.Truck(s.columns[7])]}),new e.Row.Road({top:s.rows[10],direction:e.direction.RIGHT,speed:12,obstacles:[new e.Image.TurboRaceCar(s.columns[1]),new e.Image.TurboRaceCar(s.columns[7])]}),new e.Row.Road({top:s.rows[11],speed:4,obstacles:[new e.Image.RoadCar(s.columns[1]),new e.Image.RoadCar(s.columns[7])]}),new e.Row.Road({top:s.rows[12],direction:e.direction.RIGHT,speed:3,obstacles:[new e.Image.Bulldozer(s.columns[1]),new e.Image.Bulldozer(s.columns[7])]}),new e.Row.Road({top:s.rows[13],speed:4,obstacles:[new e.Image.RaceCar(s.columns[2]),new e.Image.RaceCar(s.columns[6])]})],e.observer.subscribe("render-base-layer",r)}function r(){for(var e,t=0,r=n.length;r>t;t++)e=n[t],e.render()}function o(){for(var t,r=!1,o=0,i=n.length;i>o&&(t=n[o],e.Character.getTop()!==t.getTop()||!(r=t.isCollision(e.Character.getPosition())));o++);return r&&e.observer.publish("collision"),r}function i(){for(var e,t=0,r=n.length;r>t;t++)e=n[t],e.reset()}var n=[],s={};e.observer.subscribe("reset",i),e.observer.subscribe("check-collisions",o),e.observer.subscribe("game-board-initialize",t)}(Frogger),Frogger.observer.publish("game-load");
